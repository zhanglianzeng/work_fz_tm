/******************************************************************************
*  Name: app_i2c_dimming.c
*  Description:
*  Project: INFO4 11inch
*  Auther: 
*  MCU: atmel samda1j16b
*  Comment:
******************************************************************************/
#include "../../config.h"

#if (DESERIALIZER_MODULE == 1)
#include "../iic/app_iic_comm.h"
#include "../iic/app_i2c_dimming.h"

#if (LCD_MODULE == 1)
#include "../../middle/lcd/lcd_if.h"
#endif

#if (POWER_MODULE == 1)
#include "../power/app_power_manage.h"
#endif

/**********************************************************************************************
* External objects
**********************************************************************************************/

/**********************************************************************************************
* Global variables
**********************************************************************************************/

/**********************************************************************************************
* Constants and macros
**********************************************************************************************/
 
/**********************************************************************************************
* Local types
**********************************************************************************************/

/**********************************************************************************************
* Local variables
**********************************************************************************************/
static STRDIM_DATA strDimming_data;
/**********************************************************************************************
* Local functions
**********************************************************************************************/

/**********************************************************************************************
* Global functions
**********************************************************************************************/
/*=====================================================================================================================
* Upward trac.:        APP/IIC/App_i2c_dimming
* Method      :        CI2CDimming_Rcv_Handler(uint16_t pwm_value)
* Visibility  :        void
* Description :        recieve PWM value
* Parameters  :
* ---------------------------------------------------------------------------------------------------------------------
*     Type      | Name(Direction) |                                      Description
* ---------------------------------------------------------------------------------------------------------------------
* Status_Ref  | Status   | Status reference
* ---------------------------------------------------------------------------------------------------------------------
* Return type :  void 
* ===================================================================================================================*/
static void CI2CDimming_Rcv_Handler(uint16_t pwm_value)
{
    strDimming_data.hPWM_Value = pwm_value;
    strDimming_data.bI2CRcv_Refresh_Flg = true;
}

/*=====================================================================================================================
* Upward trac.:        APP/IIC/App_i2c_dimming
* Method      :        CI2CDimming_Init(void)
* Visibility  :        void
* Description :        Dimming init function.
* Parameters  :
* ---------------------------------------------------------------------------------------------------------------------
*     Type      | Name(Direction) |                                      Description
* ---------------------------------------------------------------------------------------------------------------------
* Status_Ref  | Status   | Status reference
* ---------------------------------------------------------------------------------------------------------------------
* Return type :  void 
* ===================================================================================================================*/
void CI2CDimming_Init(void)
{
    strDimming_data.bI2CRcv_Refresh_Flg = false;
    strDimming_data.hPWM_Value = 0;
  
    CI2CComm_PushDim_CallBack(CI2CDimming_Rcv_Handler);  /*declare callback function*/
}

/*=====================================================================================================================
* Upward trac.:        APP/IIC/App_i2c_dimming
* Method      :        CI2CDimming_Deinit(void)
* Visibility  :        void
* Description :        Dimming deinit function.
* Parameters  :
* ---------------------------------------------------------------------------------------------------------------------
*     Type      | Name(Direction) |                                      Description
* ---------------------------------------------------------------------------------------------------------------------
* Status_Ref  | Status   | Status reference
* ---------------------------------------------------------------------------------------------------------------------
* Return type :  void 
* ===================================================================================================================*/
void CI2CDimming_Deinit(void)
{
    strDimming_data.bI2CRcv_Refresh_Flg = false;
    strDimming_data.hPWM_Value = 0;
}

/*=====================================================================================================================
* Upward trac.:        APP/IIC/App_i2c_dimming
* Method      :        CI2CDimming_Get_PWM_Value(void)
* Visibility  :        void
* Description :        Get PWM value
* Parameters  :
* ---------------------------------------------------------------------------------------------------------------------
*     Type      | Name(Direction) |                                      Description
* ---------------------------------------------------------------------------------------------------------------------
* Status_Ref  | Status   | Status reference
* ---------------------------------------------------------------------------------------------------------------------
* Return type :  void 
* ===================================================================================================================*/
uint16_t CI2CDimming_Get_PWM_Value(void)
{
    return strDimming_data.hPWM_Value;  /*return PWM value*/
}

/*=====================================================================================================================
* Upward trac.:        APP/IIC/App_i2c_dimming
* Method      :        CI2CDimming_Get_PWM_RefreshFlg(void)
* Visibility  :        void
* Description :        Get PWM value
* Parameters  :
* ---------------------------------------------------------------------------------------------------------------------
*     Type      | Name(Direction) |                                      Description
* ---------------------------------------------------------------------------------------------------------------------
* Status_Ref  | Status   | Status reference
* ---------------------------------------------------------------------------------------------------------------------
* Return type :  void 
* ===================================================================================================================*/
bool CI2CDimming_Get_PWM_RefreshFlg(void)
{
    return strDimming_data.bI2CRcv_Refresh_Flg;
}

/*=====================================================================================================================
* Upward trac.:        APP/IIC/App_i2c_dimming
* Method      :        CI2CDimming_Get_PWM_RefreshFlg(void)
* Visibility  :        void
* Description :        Get PWM refresh flag.
* Parameters  :
* ---------------------------------------------------------------------------------------------------------------------
*     Type      | Name(Direction) |                                      Description
* ---------------------------------------------------------------------------------------------------------------------
* Status_Ref  | Status   | Status reference
* ---------------------------------------------------------------------------------------------------------------------
* Return type :  void 
* ===================================================================================================================*/
void CI2CDimming_Clear_PWM_RefreshFlg(void)
{
    strDimming_data.bI2CRcv_Refresh_Flg = false;
}

#endif
